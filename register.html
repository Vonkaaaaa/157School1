<!doctype html>
<html lang="uk">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è ‚Äî –õ—ñ—Ü–µ–π ‚Ññ157</title>
    <meta name="description" content="–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤ —Å–∏—Å—Ç–µ–º—ñ –õ—ñ—Ü–µ—é ‚Ññ157">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/img/log.jpg">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/log.jpg">
    
    <link rel="stylesheet" href="assets/css/styles.css">
    
    <style>
      .login-container {
        min-height: 80vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 20px;
      }
      
      .login-form-wrapper {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        text-align: center;
        padding: 40px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      .login-header {
        margin-bottom: 30px;
      }
      
      .login-header h1 {
        color: #1f2937;
        font-size: 2rem;
        font-weight: 700;
        margin: 0 0 10px 0;
      }
      
      .login-header p {
        color: #6b7280;
        margin: 0;
      }
      
      .login-form {
        text-align: left;
      }
      
      .form-group {
        margin-bottom: 20px;
      }
      
      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #374151;
      }
      
      .form-input, .form-select {
        width: 100%;
        padding: 15px 20px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        font-size: 16px;
        transition: all 0.3s ease;
        box-sizing: border-box;
        background: white;
      }
      
      .form-input:focus, .form-select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      
      .login-btn, .register-btn {
        width: 100%;
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        border: none;
        padding: 15px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
      }
      
      .login-btn:hover, .register-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
      }
      
      .login-btn:active, .register-btn:active {
        transform: translateY(0);
      }
      
      .register-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      
      .login-link {
        text-align: center;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
      }
      
      .login-link p {
        color: #6b7280;
        margin: 0;
      }
      
      .login-link a {
        color: #3b82f6;
        text-decoration: none;
        font-weight: 600;
      }
      
      .login-link a:hover {
        text-decoration: underline;
      }
      
      .form-hint {
        font-size: 12px;
        color: #6b7280;
        margin-top: 5px;
      }
      
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
        background: rgba(59, 130, 246, 0.1);
        border-radius: 10px;
        margin-bottom: 20px;
      }
      
      .loading.show {
        display: block;
      }
      
      .spinner {
        border: 3px solid #f3f4f6;
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .message {
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-weight: 500;
      }
      
      .message.success {
        background: #f0fff4;
        color: #22543d;
        border: 1px solid #9ae6b4;
      }
      
      .message.error {
        background: #fef2f2;
        color: #742a2a;
        border: 1px solid #fed7d7;
      }
      
      @media (max-width: 640px) {
        .form-row {
          grid-template-columns: 1fr;
        }
        
        .login-form-wrapper {
          padding: 30px 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="bg-decor" aria-hidden="true">
      <span class="blob one"></span>
      <span class="blob two"></span>
      <span class="blob three"></span>
      <span class="blob four"></span>
      <span class="blob five"></span>
      <span class="blob six"></span>
    </div>

    <header class="site-header" role="banner">
      <div class="container nav">
        <a class="brand" href="index.html">
          <img class="brand-badge-img" src="assets/img/log.jpg" alt="–õ—ñ—Ü–µ–π ‚Ññ157">
          <span>–õ—ñ—Ü–µ–π ‚Ññ157</span>
        </a>
        <nav aria-label="–û—Å–Ω–æ–≤–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è">
          <button class="menu-toggle" aria-expanded="false" aria-controls="nav-links" data-menu-toggle aria-label="–í—ñ–¥–∫—Ä–∏—Ç–∏ –º–µ–Ω—é">
          </button>
          <div id="nav-links" class="nav-links" data-nav-links>
            <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="about.html">–ü—Ä–æ –ª—ñ—Ü–µ–π</a>
            <a href="news.html">–ù–æ–≤–∏–Ω–∏</a>
            <a href="schedule.html">–†–æ–∑–∫–ª–∞–¥</a>
            <a href="teachers.html">–í—á–∏—Ç–µ–ª—ñ</a>
            <a href="admission.html">–í—Å—Ç—É–ø</a>
            <a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
            <a href="register.html" class="register-link" aria-current="page">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
            <a href="login.html" class="login-link">–í—Ö—ñ–¥</a>
            <a href="profile.html" class="profile-link">–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</a>
          </div>
        </nav>
      </div>
    </header>

    <main class="login-container">
      <div class="login-form-wrapper">
        <div class="login-header">
          <h1>üéì –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h1>
          <p>–°—Ç–≤–æ—Ä—ñ—Ç—å –∞–∫–∞—É–Ω—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–∏—Å—Ç–µ–º–∏ –ª—ñ—Ü–µ—é</p>
        </div>
        
        <form class="login-form" id="register-form">

        <div id="message-container"></div>
        
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∞–∫–∞—É–Ω—Ç–∞...</p>
        </div>

        <div class="form-group">
          <label class="form-label" for="username">–ù—ñ–∫–Ω–µ–π–º *</label>
          <input type="text" id="username" name="username" class="form-input" required 
                 placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω—ñ–∫–Ω–µ–π–º" minlength="3" maxlength="20">
          <div class="form-hint">–ú—ñ–Ω—ñ–º—É–º 3 —Å–∏–º–≤–æ–ª–∏, —Ç—ñ–ª—å–∫–∏ –ª—ñ—Ç–µ—Ä–∏ —Ç–∞ —Ü–∏—Ñ—Ä–∏</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="password">–ü–∞—Ä–æ–ª—å *</label>
          <input type="password" id="password" name="password" class="form-input" required 
                 placeholder="–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å" minlength="6">
          <div class="form-hint">–ú—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="confirmPassword">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é *</label>
          <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" required 
                 placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
          <div class="form-hint">–ü–∞—Ä–æ–ª—ñ –ø–æ–≤–∏–Ω–Ω—ñ —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏</div>
        </div>

        <button type="submit" class="register-btn" id="register-btn">
          üìù –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è
        </button>

        </form>
        
        <div class="login-link">
          <p>–í–∂–µ –º–∞—î—Ç–µ –∞–∫–∞—É–Ω—Ç? <a href="login.html">–£–≤—ñ–π—Ç–∏</a></p>
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container">
        <div>¬© <span id="year"></span> –õ—ñ—Ü–µ–π ‚Ññ157 –º. –•–∞—Ä–∫—ñ–≤. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</div>
      </div>
    </footer>

    <script src="assets/js/main.js"></script>
    <script src="assets/js/database.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
      class RegisterManager {
        constructor() {
          this.form = document.getElementById('register-form');
          this.messageContainer = document.getElementById('message-container');
          this.loading = document.getElementById('loading');
          this.registerBtn = document.getElementById('register-btn');
          
          this.setupEventListeners();
          this.setupPasswordValidation();
        }

        setupEventListeners() {
          this.form.addEventListener('submit', (e) => this.handleSubmit(e));
          
          // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
          document.getElementById('username').addEventListener('input', (e) => this.validateUsername(e.target.value));
          document.getElementById('email').addEventListener('input', (e) => this.validateEmail(e.target.value));
          document.getElementById('confirmPassword').addEventListener('input', (e) => this.validatePasswordMatch());
        }

        setupPasswordValidation() {
          const passwordInput = document.getElementById('password');
          const requirements = {
            length: document.getElementById('req-length'),
            letter: document.getElementById('req-letter'),
            number: document.getElementById('req-number')
          };

          passwordInput.addEventListener('input', (e) => {
            const password = e.target.value;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–≤–∂–∏–Ω–∏
            if (password.length >= 6) {
              requirements.length.classList.add('valid');
              requirements.length.classList.remove('invalid');
            } else {
              requirements.length.classList.add('invalid');
              requirements.length.classList.remove('valid');
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª—ñ—Ç–µ—Ä–∏
            if (/[a-zA-Z–∞-—è–ê-–Ø]/.test(password)) {
              requirements.letter.classList.add('valid');
              requirements.letter.classList.remove('invalid');
            } else {
              requirements.letter.classList.add('invalid');
              requirements.letter.classList.remove('valid');
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ü–∏—Ñ—Ä–∏
            if (/\d/.test(password)) {
              requirements.number.classList.add('valid');
              requirements.number.classList.remove('invalid');
            } else {
              requirements.number.classList.add('invalid');
              requirements.number.classList.remove('valid');
            }
            
            this.validatePasswordMatch();
          });
        }

        validateUsername(username) {
          const usernameRegex = /^[a-zA-Z0-9_]+$/;
          return username.length >= 3 && username.length <= 20 && usernameRegex.test(username);
        }

        validateEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        }

        validatePasswordMatch() {
          const password = document.getElementById('password').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          
          if (confirmPassword && password !== confirmPassword) {
            document.getElementById('confirmPassword').style.borderColor = '#e53e3e';
            return false;
          } else if (confirmPassword) {
            document.getElementById('confirmPassword').style.borderColor = '#38a169';
            return true;
          }
          return true;
        }

        showMessage(message, type) {
          this.messageContainer.innerHTML = `
            <div class="message ${type}">
              ${message}
            </div>
          `;
        }

        setLoading(loading) {
          if (loading) {
            this.loading.style.display = 'block';
            this.registerBtn.disabled = true;
            this.form.style.opacity = '0.6';
          } else {
            this.loading.style.display = 'none';
            this.registerBtn.disabled = false;
            this.form.style.opacity = '1';
          }
        }

        async handleSubmit(e) {
          e.preventDefault();
          
          const formData = new FormData(this.form);
          const data = Object.fromEntries(formData.entries());
          
          // –í–∞–ª—ñ–¥–∞—Ü—ñ—è
          if (!this.validateForm(data)) {
            return;
          }
          
          this.setLoading(true);
          
          try {
            // –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
            const userData = {
              username: data.username.trim(),
              password: data.password,
              email: data.username.trim() + '@lyceum157.kh.ua',
              fullName: data.username.trim(),
              phone: '',
              class: '',
              role: 'user'
            };

            // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–∏—Ö
            const result = await window.database.registerUser(userData);
            
            if (result.success) {
              this.showMessage('üéâ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ —É–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.', 'success');
              
              // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏
              setTimeout(() => {
                window.location.href = 'login.html';
              }, 2000);
            } else {
              this.showMessage(`‚ùå ${result.message}`, 'error');
            }
          } catch (error) {
            console.error('–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:', error);
            this.showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.', 'error');
          } finally {
            this.setLoading(false);
          }
        }

        validateForm(data) {
          // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–±–æ–≤'—è–∑–∫–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
          if (!data.username || !data.password || !data.confirmPassword) {
            this.showMessage('‚ùå –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è', 'error');
            return false;
          }

          // –í–∞–ª—ñ–¥–∞—Ü—ñ—è username
          if (!this.validateUsername(data.username)) {
            this.showMessage('‚ùå –ù—ñ–∫–Ω–µ–π–º –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ 3-20 —Å–∏–º–≤–æ–ª—ñ–≤ (–ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏, –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è)', 'error');
            return false;
          }

          // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–∞—Ä–æ–ª—é
          if (data.password.length < 6) {
            this.showMessage('‚ùå –ü–∞—Ä–æ–ª—å –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤', 'error');
            return false;
          }

          // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±—ñ–≥—É –ø–∞—Ä–æ–ª—ñ–≤
          if (data.password !== data.confirmPassword) {
            this.showMessage('‚ùå –ü–∞—Ä–æ–ª—ñ –Ω–µ –∑–±—ñ–≥–∞—é—Ç—å—Å—è', 'error');
            return false;
          }

          return true;
        }
      }

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
      document.addEventListener('DOMContentLoaded', () => {
        new RegisterManager();
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
  </body>
</html>
